var e=require("cannon-es"),r=require("three/examples/jsm/math/ConvexHull.js"),t=require("three"),n=Math.PI/2,a={BOX:"Box",CYLINDER:"Cylinder",SPHERE:"Sphere",HULL:"ConvexPolyhedron",MESH:"Trimesh"},o=function(o,y){var l;if((y=y||{}).type===a.BOX)return m(o);if(y.type===a.CYLINDER)return function(r,a){var o=["x","y","z"],i=a.cylinderAxis||"y",m=o.splice(o.indexOf(i),1)&&o,u=(new t.Box3).setFromObject(r);if(!isFinite(u.min.lengthSq()))return null;var s=u.max[i]-u.min[i],y=.5*Math.max(u.max[m[0]]-u.min[m[0]],u.max[m[1]]-u.min[m[1]]),l=new e.Cylinder(y,y,s,12);return l._type=e.Shape.types.CYLINDER,l.radiusTop=y,l.radiusBottom=y,l.height=s,l.numSegments=12,l.orientation=new e.Quaternion,l.orientation.setFromEuler("y"===i?n:0,"z"===i?n:0,0,"XYZ").normalize(),l}(o,y);if(y.type===a.SPHERE)return function(r,t){if(t.sphereRadius)return new e.Sphere(t.sphereRadius);var n=u(r);return n?(n.computeBoundingSphere(),new e.Sphere(n.boundingSphere.radius)):null}(o,y);if(y.type===a.HULL)return function(n){var a=u(n);if(!a||!a.vertices.length)return null;for(var o=0;o<a.vertices.length;o++)a.vertices[o].x+=1e-4*(Math.random()-.5),a.vertices[o].y+=1e-4*(Math.random()-.5),a.vertices[o].z+=1e-4*(Math.random()-.5);var i=(new r.ConvexHull).setFromObject(new t.Mesh(a)).faces,m=[],s=[];for(o=0;o<i.length;o++){var y=i[o],l=y.edge;do{var p=l.head().point;m.push(new e.Vec3(p.x,p.y,p.z)),s.push(new e.Vec3(y.normal.x,y.normal.y,y.normal.z)),l=l.next}while(l!==y.edge)}return new e.ConvexPolyhedron({vertices:m,normals:s})}(o);if(y.type===a.MESH)return(l=u(o))?function(r){var t=s(r);if(!t.length)return null;var n=Object.keys(t).map(Number);return new e.Trimesh(t,n)}(l):null;if(y.type)throw new Error('[CANNON.threeToCannon] Invalid type "%s".',y.type);if(!(l=u(o)))return null;switch(l.metadata?l.metadata.type:l.type){case"BoxGeometry":case"BoxBufferGeometry":return i(l);case"CylinderGeometry":case"CylinderBufferGeometry":return function(r){var n=r.metadata?r.metadata.parameters:r.parameters,a=new e.Cylinder(n.radiusTop,n.radiusBottom,n.height,n.radialSegments);return a._type=e.Shape.types.CYLINDER,a.radiusTop=n.radiusTop,a.radiusBottom=n.radiusBottom,a.height=n.height,a.numSegments=n.radialSegments,a.orientation=new e.Quaternion,a.orientation.setFromEuler(t.Math.degToRad(-90),0,0,"XYZ").normalize(),a}(l);case"PlaneGeometry":case"PlaneBufferGeometry":return function(r){r.computeBoundingBox();var t=r.boundingBox;return new e.Box(new e.Vec3((t.max.x-t.min.x)/2||.1,(t.max.y-t.min.y)/2||.1,(t.max.z-t.min.z)/2||.1))}(l);case"SphereGeometry":case"SphereBufferGeometry":return function(r){return new e.Sphere((r.metadata?r.metadata.parameters:r.parameters).radius)}(l);case"TubeGeometry":case"Geometry":case"BufferGeometry":return m(o);default:return console.warn('Unrecognized geometry: "%s". Using bounding box as shape.',l.type),i(l)}};function i(r){if(!s(r).length)return null;r.computeBoundingBox();var t=r.boundingBox;return new e.Box(new e.Vec3((t.max.x-t.min.x)/2,(t.max.y-t.min.y)/2,(t.max.z-t.min.z)/2))}function m(r){var n=r.clone();n.quaternion.set(0,0,0,1),n.updateMatrixWorld();var a=(new t.Box3).setFromObject(n);if(!isFinite(a.min.lengthSq()))return null;var o=new e.Box(new e.Vec3((a.max.x-a.min.x)/2,(a.max.y-a.min.y)/2,(a.max.z-a.min.z)/2)),i=a.translate(n.position.negate()).getCenter(new t.Vector3);return i.lengthSq()&&(o.offset=i),o}function u(e){var r,n=function(e){var r=[];return e.traverse(function(e){"Mesh"===e.type&&r.push(e)}),r}(e),a=new t.Geometry,o=new t.Geometry;if(0===n.length)return null;if(1===n.length){var i=new t.Vector3,m=new t.Quaternion,u=new t.Vector3;return n[0].geometry.isBufferGeometry?n[0].geometry.attributes.position&&n[0].geometry.attributes.position.itemSize>2&&a.fromBufferGeometry(n[0].geometry):a=n[0].geometry.clone(),a.metadata=n[0].geometry.metadata,n[0].updateMatrixWorld(),n[0].matrixWorld.decompose(i,m,u),a.scale(u.x,u.y,u.z)}for(;r=n.pop();)if(r.updateMatrixWorld(),r.geometry.isBufferGeometry){if(r.geometry.attributes.position&&r.geometry.attributes.position.itemSize>2){var s=new t.Geometry;s.fromBufferGeometry(r.geometry),o.merge(s,r.matrixWorld),s.dispose()}}else o.merge(r.geometry,r.matrixWorld);var y=new t.Matrix4;return y.scale(e.scale),o.applyMatrix(y),o}function s(e){return e.attributes||(e=(new t.BufferGeometry).fromGeometry(e)),(e.attributes.position||{}).array||[]}o.Type=a,exports.threeToCannon=o;
//# sourceMappingURL=three-to-cannon.js.map
